<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Bank Kart Sifari≈üi</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@300;400;500;600&display=swap');
        
        :root {
            --primary: #00A3C9;
            --primary-dark: #008aad;
            --primary-light: #33b5d5;
            --primary-lighter: #66c7e1;
            --primary-pale: #e6f7fb;
            --bg-main: #fafbfc;
            --bg-section: #ffffff;
            --text-primary: #1a2332;
            --text-secondary: #5f6b7a;
            --border: #e1e6eb;
            --success: #00A3C9;
            --error: #c93a3a;
            --warning: #00A3C9;
            --shadow-sm: 0 1px 3px rgba(0, 163, 201, 0.08);
            --shadow-md: 0 4px 12px rgba(0, 163, 201, 0.12);
            --shadow-lg: 0 8px 24px rgba(0, 163, 201, 0.16);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            font-family: 'Work Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 1rem;
        }
        
        @media (min-width: 768px) {
            body { padding: 2rem 1rem; }
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }
        
        .page {
            display: none;
        }
        
        .page.active { 
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .card {
            background: var(--bg-section);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .card {
                border-radius: 16px;
                padding: 2.5rem;
                margin-bottom: 1.5rem;
            }
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
        }
        
        .card.disabled {
            opacity: 0.5;
            pointer-events: none;
            user-select: none;
        }
        
        h1 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
            line-height: 1.3;
        }
        
        @media (min-width: 768px) {
            h1 { font-size: 2rem; }
        }
        
        h2 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border);
            line-height: 1.3;
        }
        
        @media (min-width: 768px) {
            h2 {
                font-size: 1.5rem;
                margin-bottom: 1.5rem;
            }
        }
        
        .header-info {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            padding: 1.5rem;
            background: var(--primary);
            border-radius: 10px;
            margin-bottom: 1.5rem;
            color: white;
        }
        
        @media (min-width: 480px) {
            .header-info {
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
                padding: 1.5rem 1.75rem;
                border-radius: 12px;
                margin-bottom: 2rem;
            }
        }
        
        .header-item {
            display: flex;
            flex-direction: column;
        }
        
        .header-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.9;
            margin-bottom: 0.4rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
        }
        
        .header-value {
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: -0.01em;
            word-break: break-word;
            color: #ffffff;
        }
        
        @media (min-width: 768px) {
            .header-value {
                font-size: 1.1rem;
            }
        }
        
        .section {
            margin-bottom: 1.5rem;
        }
        
        @media (min-width: 768px) {
            .section {
                margin-bottom: 2rem;
            }
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--primary);
            margin-right: 0.75rem;
            border-radius: 2px;
            flex-shrink: 0;
        }
        
        .btn {
            padding: 0.875rem 1.25rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Work Sans', sans-serif;
            letter-spacing: 0.01em;
            width: 100%;
            -webkit-appearance: none;
            min-height: 48px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        @media (min-width: 768px) {
            .btn {
                padding: 0.75rem 1.5rem;
                font-size: 0.95rem;
                width: auto;
            }
        }
        
        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-sm);
        }
        
        .btn-primary:not(:disabled):active {
            transform: scale(0.98);
            background: var(--primary-dark);
        }
        
        @media (hover: hover) {
            .btn-primary:not(:disabled):hover {
                background: var(--primary-dark);
                box-shadow: var(--shadow-md);
            }
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-secondary:not(:disabled):active {
            transform: scale(0.98);
        }
        
        @media (hover: hover) {
            .btn-secondary:not(:disabled):hover {
                background: var(--primary);
                color: white;
            }
        }
        
        .btn-success {
            background: var(--primary);
            color: white;
        }
        
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        @media (min-width: 768px) {
            .btn-group {
                flex-direction: row;
                gap: 1rem;
                margin-top: 2rem;
            }
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-main);
            min-height: 60px;
        }
        
        .checkbox-item.selected {
            border-color: var(--primary);
            background: var(--primary-pale);
        }
        
        .checkbox-item input[type="checkbox"],
        .checkbox-item input[type="radio"] {
            margin-right: 0.75rem;
            margin-top: 0.25rem;
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: var(--primary);
            flex-shrink: 0;
            min-width: 22px;
        }
        
        .checkbox-label {
            flex: 1;
            font-size: 0.9rem;
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        select, .form-input, .mut-select {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: 'Work Sans', sans-serif;
            background: white;
            transition: all 0.2s ease;
            min-height: 48px;
        }
        
        select {
            cursor: pointer;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%2300A3C9' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            padding-right: 2.5rem;
        }
        
        select:focus, .form-input:focus, .mut-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-pale);
        }
        
        textarea.mut-select {
            min-height: 100px;
            resize: vertical;
            background-image: none;
        }
        
        .filial-select {
            display: none;
            margin-top: 1rem;
        }
        
        .filial-select.show {
            display: block;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            font-size: 0.85rem;
            line-height: 1.5;
        }
        
        .alert-info {
            background: var(--primary-pale);
            color: var(--primary-dark);
            border-left: 4px solid var(--primary);
        }
        
        .alert-success {
            background: var(--primary-pale);
            color: var(--primary-dark);
            border-left: 4px solid var(--primary);
        }
        
        .alert-error {
            background: rgba(201, 58, 58, 0.08);
            color: var(--error);
            border-left: 4px solid var(--error);
        }
        
        .alert-warning {
            background: var(--primary-pale);
            color: var(--primary-dark);
            border-left: 4px solid var(--primary-light);
        }
        
        .progress-bar {
            height: 5px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 1.5rem;
            position: -webkit-sticky;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            transition: width 0.5s ease;
            border-radius: 3px;
        }
        
        .access-check {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--bg-main);
            border-radius: 10px;
            border: 2px solid var(--border);
        }
        
        @media (min-width: 768px) {
            .access-check {
                flex-direction: row;
                align-items: center;
                gap: 1rem;
                padding: 1.25rem;
            }
        }
        
        .access-check-label {
            flex: 1;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        
        .consent-box {
            padding: 1rem;
            background: var(--bg-main);
            border: 2px solid var(--border);
            border-radius: 10px;
            margin-top: 1rem;
        }
        
        .consent-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            cursor: pointer;
        }
        
        .consent-checkbox input[type="checkbox"] {
            margin-top: 0.25rem;
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
            flex-shrink: 0;
        }
        
        .consent-text {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-primary);
        }
        
        .consent-link {
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
            text-decoration: underline;
        }
        
        .consent-link:active {
            color: var(--primary-dark);
        }
        
        .toggle-item {
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--bg-main);
            border-radius: 10px;
            border-left: 4px solid var(--primary-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        
        .toggle-item.error {
            border-left-color: var(--error);
            background: rgba(201, 58, 58, 0.05);
        }
        
        .toggle-text {
            font-size: 0.9rem;
            color: var(--text-primary);
            font-weight: 500;
            line-height: 1.5;
            flex: 1;
        }
        
        .toggle-switch {
            position: relative;
            width: 56px;
            height: 30px;
            flex-shrink: 0;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--primary);
        }
        
        .toggle-switch input:disabled + .toggle-slider {
            background-color: var(--error);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(26px);
            -webkit-transform: translateX(26px);
        }
        
        .toggle-labels {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .toggle-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 35px;
            text-align: center;
        }
        
        .toggle-label.active {
            color: var(--primary);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            padding: 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (min-width: 768px) {
            .modal {
                padding: 2rem;
            }
        }
        
        .modal.show {
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        
        @media (min-width: 768px) {
            .modal.show {
                align-items: center;
            }
        }
        
        .modal-content {
            background: white;
            border-radius: 0;
            max-width: 900px;
            width: 100%;
            max-height: 100vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            box-shadow: var(--shadow-lg);
        }
        
        @media (min-width: 768px) {
            .modal-content {
                border-radius: 16px;
                max-height: 90vh;
            }
        }
        
        .modal-header {
            padding: 1.25rem;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--primary);
            color: white;
            position: -webkit-sticky;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .modal-title {
            font-family: 'Crimson Pro', serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
        }
        
        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .modal-close:active {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .modal-body {
            padding: 1.25rem;
        }
        
        @media (min-width: 768px) {
            .modal-body {
                padding: 2rem 2.5rem;
            }
        }
        
        .modal-footer {
            padding: 1rem;
            border-top: 2px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            position: -webkit-sticky;
            position: sticky;
            bottom: 0;
            background: white;
        }
        
        @media (min-width: 768px) {
            .modal-footer {
                padding: 1.5rem 2.5rem;
                flex-direction: row;
                justify-content: flex-end;
                gap: 1rem;
            }
        }
        
        .mut-question {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-main);
            border-radius: 10px;
            border-left: 4px solid var(--primary-light);
        }
        
        .mut-question.mandatory {
            border-left-color: var(--primary);
        }
        
        .mut-question-number {
            font-size: 0.75rem;
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }
        
        .mut-question-text {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            line-height: 1.5;
        }
        
        .question-item {
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--bg-main);
            border-radius: 10px;
            border-left: 4px solid var(--primary-light);
        }
        
        .question-text {
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-weight: 500;
            line-height: 1.5;
        }
        
        @media screen and (max-width: 767px) {
            select, input, textarea {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        
        <div id="page1" class="page active">
            <div class="card">
                <h1>Kart Sifari≈üi Formasƒ±</h1>
                
                <div class="header-info" id="headerInfo">
                    <div class="header-item">
                        <div class="header-label">M√º…ôssis…ônin adƒ±</div>
                        <div class="header-value" id="companyName">Y√ºkl…ônir...</div>
                    </div>
                    <div class="header-item">
                        <div class="header-label">V√ñEN</div>
                        <div class="header-value" id="voen">Y√ºkl…ônir...</div>
                    </div>
                    <div class="header-item">
                        <div class="header-label">Ad Soyad</div>
                        <div class="header-value" id="fullNameDisplay">Y√ºkl…ônir...</div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>Asan Finans Yoxlamasƒ±</h2>
                    
                    <div class="consent-box">
                        <label class="consent-checkbox">
                            <input type="checkbox" id="preConsentCheck" onchange="handlePreConsentChange()">
                            <div class="consent-text">
                                M…ôlumatlarƒ±mƒ±n 
                                <span class="consent-link" onclick="showTermsModal('akb')">"Az…ôrbaycan Kredit B√ºrosu"</span>, 
                                <span class="consent-link" onclick="showTermsModal('asan')">"ASAN Finans"</span> 
                                v…ô dig…ôr m…ôlumat bazalarƒ±ndan sorƒüu edilm…ôsin…ô razƒ±lƒ±q verir…ôm.
                            </div>
                        </label>
                    </div>
                    
                    <div class="access-check" style="margin-top: 1rem;">
                        <div class="access-check-label">Asan Finans giri≈ü h√ºququnu yoxlayƒ±n</div>
                        <button class="btn btn-primary" id="checkBtn" onclick="checkAsanFinans()" disabled>Yoxla</button>
                    </div>
                    <div id="asanFinansStatus"></div>
                    
                    <div class="consent-box" id="consentBox" style="display: none;">
                        <label class="consent-checkbox">
                            <input type="checkbox" id="dataConsentCheck" onchange="handleConsentChange()">
                            <div class="consent-text">
                                M…ôlumatlarƒ±mƒ±n 
                                <span class="consent-link" onclick="showTermsModal('akb')">"Az…ôrbaycan Kredit B√ºrosu"</span>, 
                                <span class="consent-link" onclick="showTermsModal('asan')">"ASAN Finans"</span> 
                                v…ô dig…ôr m…ôlumat bazalarƒ±ndan sorƒüu edilm…ôsin…ô razƒ±lƒ±q verir…ôm.
                            </div>
                        </label>
                    </div>
                </div>
                
                <div class="section" id="deliverySection">
                    <h2>T…ôhvil Alma Formasƒ±</h2>
                    <div class="checkbox-group">
                        <label class="checkbox-item" id="deliveryOption1">
                            <input type="radio" name="delivery" value="employer" onchange="handleDeliveryChange()">
                            <span class="checkbox-label">Kartƒ±n i≈ü…ôg√∂t√ºr…ôn…ô v…ô ya onun n√ºmay…ônd…ôsin…ô t…ôhvil verilm…ôsi</span>
                        </label>
                        
                        <label class="checkbox-item" id="deliveryOption2">
                            <input type="radio" name="delivery" value="self" onchange="handleDeliveryChange()">
                            <span class="checkbox-label">Kart sahibinin √∂z√º t…ôr…ôfind…ôn g√∂t√ºr√ºlm…ôsi</span>
                        </label>
                    </div>
                    
                    <div id="filialSelect" class="filial-select">
                        <select id="filialDropdown">
                            <option value="">Filial se√ßin</option>
                            <option value="f1">N…ôrimanov filialƒ±</option>
                            <option value="f2">28 May filialƒ±</option>
                            <option value="f3">Nizami filialƒ±</option>
                            <option value="f4">N…ôsimi filialƒ±</option>
                            <option value="f5">Yasamal filialƒ±</option>
                            <option value="f6">Bin…ôq…ôdi filialƒ±</option>
                            <option value="f7">X…ôtai filialƒ±</option>
                            <option value="f8">S…ôbail filialƒ±</option>
                            <option value="f9">Suraxanƒ± filialƒ±</option>
                            <option value="f10">Qaradaƒü filialƒ±</option>
                            <option value="f11">X…ôz…ôr filialƒ±</option>
                            <option value="f12">Pirallahƒ± filialƒ±</option>
                            <option value="f13">Sumqayƒ±t filialƒ±</option>
                            <option value="f14">G…ônc…ô filialƒ±</option>
                            <option value="f15">≈ûirvan filialƒ±</option>
                            <option value="f16">Ming…ô√ßevir filialƒ±</option>
                            <option value="f17">L…ônk…ôran filialƒ±</option>
                            <option value="f18">≈û…ôki filialƒ±</option>
                            <option value="f19">Quba filialƒ±</option>
                            <option value="f20">Nax√ßƒ±van filialƒ±</option>
                        </select>
                    </div>
                </div>
                
                <div class="section" id="fatcaSection">
                    <h2>√ñz√ºn√º qiym…ôtl…ôndirm…ô anketi</h2>
                    <div id="fatcaQuestions"></div>
                </div>
                
                <div class="section" id="mutSection">
                    <h2>Sorƒüu anketi</h2>
                    <div onclick="openMutModal()" style="display: flex; flex-direction: column; gap: 0.75rem; padding: 1rem; background: var(--bg-main); border: 2px solid var(--border); border-radius: 10px; cursor: pointer;">
                        <div style="display: flex; flex-direction: column;">
                            <div style="font-weight: 600; color: var(--primary); margin-bottom: 0.25rem; font-size: 0.95rem;">Sorƒüu anketini doldurun</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">27 sual - m√º≈üt…ôri t…ôr…ôfind…ôn doldurulmalƒ±dƒ±r</div>
                        </div>
                        <button class="btn btn-secondary" style="margin-top: 0.5rem;" onclick="event.stopPropagation(); openMutModal();">∆ètraflƒ±</button>
                    </div>
                    <div id="mutCompletionStatus"></div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" id="nextPageBtn" onclick="goToPage2()">N√∂vb…ôti S…ôhif…ô ‚Üí</button>
                </div>
            </div>
        </div>
        
        <div id="page2" class="page">
            <div class="card">
                <h1>M…ôlumatlarƒ±n T…ôsdiqi</h1>
                
                <div class="alert alert-info">
                    <span>‚ö†Ô∏è</span>
                    <span>Z…ôhm…ôt olmasa doldurduƒüunuz m…ôlumatlarƒ± yoxlayƒ±n v…ô t…ôsdiq edin.</span>
                </div>
                
                <div class="section">
                    <h2>T…ôhvil Alma</h2>
                    <div id="summaryDelivery"></div>
                </div>
                
                <div class="section">
                    <h2>√ñz√ºn√º qiym…ôtl…ôndirm…ô cavablarƒ±</h2>
                    <div id="summaryFatca"></div>
                </div>
                
                <div class="section">
                    <h2>Sorƒüu anketi</h2>
                    <div id="summaryMut"></div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goToPage1()">‚Üê Geri</button>
                    <button class="btn btn-success" onclick="submitForm()">G√∂nd…ôr ‚úì</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="termsModalTitle">≈û…ôrtl…ôr v…ô Qaydalar</h2>
                <button class="modal-close" onclick="closeTermsModal()">√ó</button>
            </div>
            <div class="modal-body" id="termsModalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeTermsModal()">Baƒüla</button>
            </div>
        </div>
    </div>
    
    <div id="fatcaWarningModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Diqq…ôt</h2>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <span>‚ö†Ô∏è</span>
                    <div>
                        <strong>Siz "B…ôli" cavabƒ±nƒ± se√ßdiniz.</strong>
                        <p style="margin-top: 0.75rem; font-size: 0.95rem;">Davam etm…ôk √º√ß√ºn filiala y√∂nl…ôndiril…ôc…ôksiniz.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeFatcaWarning(true)" style="width: 100%;">B…ôli, davam ed…ôk</button>
            </div>
        </div>
    </div>
    
    <div id="mutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Sorƒüu anketi</h2>
                <button class="modal-close" onclick="closeMutModal()">√ó</button>
            </div>
            <div class="modal-body" id="mutModalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMutModal()">L…ôƒüv et</button>
                <button class="btn btn-primary" onclick="saveMutAnswers()">Yadda saxla</button>
            </div>
        </div>
    </div>

    <script>
        const fatcaQuestions = [
            { id: 'q1', text: 'Xaricd…ô olan h…ôr hansƒ± bank hesabƒ±na d√∂vri √∂d…ôni≈ül…ôr edilm…ôsi il…ô baƒülƒ± g√∂st…ôri≈ü vermisinizmi v…ô ya verm…ôyi planla≈üdƒ±rƒ±rsƒ±nƒ±zmƒ±?' },
            { id: 'q2', text: 'Xaricd…ô √ºnvanƒ± olan ≈ü…ôxs…ô etibarnam…ô v…ô ya imza s…ôlahiyy…ôti vermisinizmi v…ô ya verm…ôyi planla≈üdƒ±rƒ±rsƒ±nƒ±zmƒ±?' },
            { id: 'q3', text: 'Maliyy…ô institutuna √∂z yegan…ô √ºnvanƒ±nƒ±z kimi "vasit…ô√ßi √ºnvanƒ±" v…ô ya "…ôman…ôt √ºnvanƒ±" t…ôqdim etm…ôk fikrind…ôsinizmi?' },
            { id: 'q4', text: 'Xarici telefon n√∂mr…ôsin…ô sahibsinizmi?' },
            { id: 'q5', text: '"Green Card"a sahibsinizmi (etibarlƒ±lƒ±q m√ºdd…ôtind…ôn asƒ±lƒ± olmayaraq)?' },
            { id: 'q6', text: 'AB≈û-da √ºnvanƒ±nƒ±z varmƒ±?' },
            { id: 'q7', text: 'Az…ôrbaycan rezidentliyind…ôn ba≈üqa rezidentliyiniz varmƒ±?' },
            { id: 'q8', text: 'Xaricd…ô m√º…ôyy…ôn m√ºdd…ôt ke√ßirm…ô testinin ≈ü…ôrtl…ôrini t…ômin edirsiniz mi?' }
        ];
        
        const mutQuestions = [
            { id: 'm1', text: 'Ad, soyad v…ô ya ata adƒ± d…ôyi≈üdirildikd…ô …ôvv…ôlki ad, soyad v…ô atasƒ±nƒ±n adƒ±:', type: 'input', mandatory: false },
            { id: 'm2', text: 'ƒ∞≈ü yeri', type: 'input', mandatory: true },
            { id: 'm3', text: 'V…ôzif…ôsi', type: 'input', mandatory: true },
            { id: 'm4', text: 'Rezidentlik', type: 'input', mandatory: true },
            { id: 'm5', text: 'Az…ôrbaycan rezidentliyind…ôn ba≈üqa rezidentlik varmi?', type: 'toggle', mandatory: false },
            { id: 'm6', text: 'V…ôt…ônda≈üƒ± olduƒüu √∂lk…ô(l…ôr):', type: 'input', mandatory: true },
            { id: 'm7', text: 'E-mail:', type: 'email', mandatory: true },
            { id: 'm8', text: 'Faktiki v…ô po√ßt √ºnvanlarƒ± qeydiyyat √ºnvanƒ± il…ô eynidir?', type: 'toggle', mandatory: false },
            { id: 'm9', text: 'ƒ∞stifad…ô ed…ôc…ôyiniz m…ôhsul?', type: 'select', options: ['Se√ßin', 'Debet kart', 'Kredit kart', 'Virtual kart'], mandatory: true },
            { id: 'm10', text: '∆èm…ôliyyat ke√ßirm…ôyi planla≈üdƒ±rdƒ±ƒüƒ±nƒ±z √∂lk…ôl…ôr', type: 'textarea', mandatory: false },
            { id: 'm11', text: 'M…ôhsuldan istifad…ô edil…ôc…ôyi sah…ôl…ôr, platformalar:', type: 'textarea', mandatory: false },
            { id: 'm12', text: 'M…ôhsulun idar…ô edilm…ôsi √ºsulu', type: 'select', options: ['Se√ßin', 'Mobil t…ôtbiq', 'ƒ∞nternet bank', 'Filial', 'ATM'], mandatory: true },
            { id: 'm13', text: 'V…ôsaitl…ôrin m…ôdaxil edilm…ôsinin √ºsullarƒ±:', type: 'select', options: ['Se√ßin', 'Naƒüd', 'K√∂√ß√ºrm…ô', 'Maa≈ü', '∆èman…ôt'], mandatory: true },
            { id: 'm14', text: 'M…ôdaxil v…ô m…ôxaric …ôm…ôliyyatlarƒ±n ehtimal edil…ôn h…ôcmi', type: 'select', options: ['Se√ßin', '0-1000 AZN', '1000-5000 AZN', '5000-10000 AZN', '10000+ AZN'], mandatory: true },
            { id: 'm15', text: '∆èm…ôliyyatƒ±n istiqam…ôtl…ôri', type: 'select', options: ['Se√ßin', 'Daxili', 'Xarici', 'H…ôr ikisi'], mandatory: true },
            { id: 'm16', text: 'V…ôsaitl…ôrin m…ôdaxil edilm…ôsinin d√∂v√ºrl√ºy√º:', type: 'select', options: ['Se√ßin', 'G√ºnd…ôlik', 'H…ôft…ôlik', 'Aylƒ±q', 'Qeyri-m√ºnt…ôz…ôm'], mandatory: true },
            { id: 'm17', text: 'V…ôsaitl…ôrin m…ôdaxil edilm…ôsinin m…ônb…ôl…ôri:', type: 'select', options: ['Se√ßin', '∆èm…ôk haqqƒ±', 'Biznes g…ôliri', 'ƒ∞car…ô', 'Dig…ôr'], mandatory: true },
            { id: 'm18', text: 'Son 12 ayda xaric…ô v…ô xaricd…ôn k√∂√ß√ºrm…ôl…ôr olubmu?', type: 'toggle', mandatory: false },
            { id: 'm19', text: 'G…ôlir m…ônb…ôyi', type: 'select', options: ['Se√ßin', '∆èm…ôk haqqƒ±', 'Sahibkarlƒ±q', '∆èmlak g…ôliri', 'Dividend', 'Pensiya'], mandatory: true },
            { id: 'm20', text: 'Orta illik g…ôlirin m…ôbl…ôƒüi (AZN)', type: 'select', options: ['Se√ßin', '0-10000', '10000-30000', '30000-60000', '60000-100000', '100000+'], mandatory: true },
            { id: 'm21', text: 'Dig…ôr g…ôlir m…ônb…ôyi varsa …ôlav…ô edin', type: 'textarea', mandatory: false },
            { id: 'm22', text: 'Siyasi n√ºfuzlu ≈ü…ôxsiniz?', type: 'toggle', mandatory: false },
            { id: 'm23', text: 'Siz siyasi xadimin qohumu v…ô ya siyasi xadiml…ô …ôlaq…ôniz varmƒ±?', type: 'toggle', mandatory: false },
            { id: 'm24', text: 'Sponsor (sizi maliyy…ôl…ô≈üdir…ôn ≈ü…ôxs v…ô ya ≈ü…ôxsl…ôr)', type: 'input', mandatory: false },
            { id: 'm25', text: '∆èm…ôliyyat (…ôqd) ba≈üqa ≈ü…ôxsin xeyrin…ô v…ô ya tap≈üƒ±rƒ±ƒüƒ± il…ô h…ôyata ke√ßirilirmi?', type: 'toggle', mandatory: false },
            { id: 'm26', text: 'Etibarnam…ô', type: 'input', mandatory: false },
            { id: 'm27', text: 'M…ôn t…ôstiq edir…ôm ki, m…ôn bu hesabƒ±n (hesablarƒ±n) sonuncu benefisiarƒ±yam.', type: 'toggle', mandatory: true }
        ];
        
        let formData = loadFromLocalStorage() || {
            fullName: '',
            companyName: '',
            voen: '',
            preConsent: false,
            asanFinansAccess: null,
            dataConsent: false,
            delivery: null,
            filial: null,
            fatca: {},
            mut: {}
        };
        
        let currentFatcaQuestion = null;
        
        function fetchUserData() {
            setTimeout(function() {
                const userData = {
                    fullName: 'Fuad ∆èsg…ôrov',
                    companyName: 'Bank of Baku OJSC',
                    voen: '1234567890'
                };
                
                formData.fullName = userData.fullName;
                formData.companyName = userData.companyName;
                formData.voen = userData.voen;
                
                document.getElementById('fullNameDisplay').textContent = userData.fullName;
                document.getElementById('companyName').textContent = userData.companyName;
                document.getElementById('voen').textContent = userData.voen;
                
                saveToLocalStorage();
            }, 500);
        }
        
        function handlePreConsentChange() {
            const checkbox = document.getElementById('preConsentCheck');
            formData.preConsent = checkbox.checked;
            
            const checkBtn = document.getElementById('checkBtn');
            checkBtn.disabled = !checkbox.checked;
            
            if (!checkbox.checked) {
                formData.asanFinansAccess = null;
                document.getElementById('asanFinansStatus').innerHTML = '';
                document.getElementById('consentBox').style.display = 'none';
            }
            
            saveToLocalStorage();
            updateFormState();
        }
        
        function initFatcaQuestions() {
            const container = document.getElementById('fatcaQuestions');
            container.innerHTML = fatcaQuestions.map(function(q) {
                const isChecked = formData.fatca[q.id] === 'yes';
                
                if (formData.fatca[q.id] === undefined) {
                    formData.fatca[q.id] = 'no';
                }
                
                return '<div class="toggle-item" id="fatca-' + q.id + '">' +
                    '<div class="toggle-text">' + q.text + '</div>' +
                    '<div class="toggle-labels">' +
                    '<span class="toggle-label ' + (!isChecked ? 'active' : '') + '">Xeyr</span>' +
                    '<label class="toggle-switch">' +
                    '<input type="checkbox" ' + (isChecked ? 'checked' : '') + ' onchange="handleFatcaToggle(\'' + q.id + '\', this.checked)">' +
                    '<span class="toggle-slider"></span>' +
                    '</label>' +
                    '<span class="toggle-label ' + (isChecked ? 'active' : '') + '">B…ôli</span>' +
                    '</div>' +
                    '</div>';
            }).join('');
            
            updateFormState();
        }
        
        function handleFatcaToggle(questionId, isChecked) {
            if (isChecked) {
                currentFatcaQuestion = questionId;
                document.getElementById('fatcaWarningModal').classList.add('show');
            } else {
                formData.fatca[questionId] = 'no';
                updateToggleLabels(questionId, false);
                saveToLocalStorage();
            }
        }
        
        function updateToggleLabels(questionId, isChecked) {
            const container = document.getElementById('fatca-' + questionId);
            if (container) {
                const labels = container.querySelectorAll('.toggle-label');
                if (labels.length === 2) {
                    if (isChecked) {
                        labels[0].classList.remove('active');
                        labels[1].classList.add('active');
                    } else {
                        labels[0].classList.add('active');
                        labels[1].classList.remove('active');
                    }
                }
            }
        }
        
        function closeFatcaWarning(confirmed) {
            const modal = document.getElementById('fatcaWarningModal');
            modal.classList.remove('show');
            
            if (currentFatcaQuestion) {
                if (confirmed) {
                    formData.fatca[currentFatcaQuestion] = 'yes';
                    updateToggleLabels(currentFatcaQuestion, true);
                    console.log('FATCA YES selected - User will be redirected to branch');
                } else {
                    formData.fatca[currentFatcaQuestion] = 'no';
                    const toggle = document.querySelector('#fatca-' + currentFatcaQuestion + ' input[type="checkbox"]');
                    if (toggle) toggle.checked = false;
                    updateToggleLabels(currentFatcaQuestion, false);
                }
                saveToLocalStorage();
                currentFatcaQuestion = null;
            }
        }
        
        function initMutQuestions() {
            const container = document.getElementById('mutModalBody');
            container.innerHTML = mutQuestions.map(function(q, index) {
                const isMandatory = q.mandatory;
                let inputHTML = '';
                
                switch (q.type) {
                    case 'input':
                        inputHTML = '<input type="text" class="mut-select" id="' + q.id + '" value="' + (formData.mut[q.id] || '') + '" onchange="saveMutAnswer(\'' + q.id + '\', this.value)">';
                        break;
                    case 'email':
                        inputHTML = '<input type="email" class="mut-select" id="' + q.id + '" value="' + (formData.mut[q.id] || '') + '" onchange="saveMutAnswer(\'' + q.id + '\', this.value)">';
                        break;
                    case 'textarea':
                        inputHTML = '<textarea class="mut-select" id="' + q.id + '" onchange="saveMutAnswer(\'' + q.id + '\', this.value)">' + (formData.mut[q.id] || '') + '</textarea>';
                        break;
                    case 'toggle':
                        const isChecked = formData.mut[q.id] === 'yes';
                        if (formData.mut[q.id] === undefined) {
                            formData.mut[q.id] = 'no';
                        }
                        inputHTML = '<div class="toggle-labels" style="justify-content: flex-start;">' +
                            '<span class="toggle-label ' + (!isChecked ? 'active' : '') + '">Xeyr</span>' +
                            '<label class="toggle-switch">' +
                            '<input type="checkbox" ' + (isChecked ? 'checked' : '') + ' onchange="saveMutAnswer(\'' + q.id + '\', this.checked ? \'yes\' : \'no\')">' +
                            '<span class="toggle-slider"></span>' +
                            '</label>' +
                            '<span class="toggle-label ' + (isChecked ? 'active' : '') + '">B…ôli</span>' +
                            '</div>';
                        break;
                    case 'select':
                        inputHTML = '<select class="mut-select" id="' + q.id + '" onchange="saveMutAnswer(\'' + q.id + '\', this.value)">';
                        q.options.forEach(function(opt) {
                            inputHTML += '<option value="' + opt + '" ' + (formData.mut[q.id] === opt ? 'selected' : '') + '>' + opt + '</option>';
                        });
                        inputHTML += '</select>';
                        break;
                    default:
                        inputHTML = '<input type="text" class="mut-select" id="' + q.id + '" value="' + (formData.mut[q.id] || '') + '" onchange="saveMutAnswer(\'' + q.id + '\', this.value)">';
                }
                
                return '<div class="mut-question ' + (isMandatory ? 'mandatory' : '') + '">' +
                    '<div class="mut-question-number">Sual ' + (index + 1) + '/27' + (isMandatory ? ' (M…ôcburi)' : '') + '</div>' +
                    '<div class="mut-question-text">' + q.text + '</div>' +
                    inputHTML +
                    '</div>';
            }).join('');
        }
        
        function checkAsanFinans() {
            const statusDiv = document.getElementById('asanFinansStatus');
            statusDiv.innerHTML = '<div class="alert alert-info" style="margin-top: 1rem;"><span>üîÑ</span> Yoxlanƒ±lƒ±r...</div>';
            
            setTimeout(function() {
                const hasAccess = Math.random() > 0.3;
                formData.asanFinansAccess = hasAccess;
                
                if (hasAccess) {
                    statusDiv.innerHTML = '<div class="alert alert-success" style="margin-top: 1rem;"><span>‚úì</span> Giri≈ü h√ºququ m√∂vcuddur</div>';
                    document.getElementById('consentBox').style.display = 'block';
                } else {
                    statusDiv.innerHTML = '<div class="alert alert-error" style="margin-top: 1rem;"><span>‚úó</span> Giri≈ü h√ºququ tapƒ±lmadƒ±. Z…ôhm…ôt olmasa sistem administratoru il…ô …ôlaq…ô saxlayƒ±n.</div>';
                    document.getElementById('consentBox').style.display = 'none';
                }
                
                saveToLocalStorage();
                updateFormState();
            }, 1500);
        }
        
        function handleConsentChange() {
            const checkbox = document.getElementById('dataConsentCheck');
            formData.dataConsent = checkbox.checked;
            saveToLocalStorage();
            updateFormState();
        }
        
        function showTermsModal(type) {
            const modal = document.getElementById('termsModal');
            const title = document.getElementById('termsModalTitle');
            const body = document.getElementById('termsModalBody');
            
            title.textContent = type === 'akb' ? 'Az…ôrbaycan Kredit B√ºrosu' : 'ASAN Finans';
            body.innerHTML = '<h3 style="margin-bottom: 1.5rem; font-size: 1.25rem; color: var(--primary);">≈û…ôrtl…ôr v…ô Qaydalar</h3>' +
                '<p style="margin-bottom: 1rem; line-height: 1.8; font-size: 0.95rem;">' +
                'Qeyd edil…ôn m…ôlumatlarƒ±n doƒüruluƒüunu t…ôsdiq edir…ôm. H…ôm√ßinin, kredit √∂hd…ôlikl…ôrimin bar…ôd…ô m…ôlumatlarƒ± ' +
                '"Az…ôrbaycan Kredit B√ºrosu" reyestrind…ôn sorƒüu etm…ôk, "ASAN Finans", "Elektron H√∂k√ºm…ôt" portalƒ±ndan ' +
                'qeydiyyatdan ke√ßirm…ôk v…ô dig…ôr m…ôlumat bazalarƒ±ndan m…ôlumatlarƒ±n …ôld…ô edilm…ôsin…ô razƒ±lƒ±ƒüƒ±mƒ± bildirir…ôm.' +
                '</p>';
            
            modal.classList.add('show');
        }
        
        function closeTermsModal() {
            document.getElementById('termsModal').classList.remove('show');
        }
        
        function handleDeliveryChange() {
            const selfDelivery = document.querySelector('input[name="delivery"][value="self"]');
            const filialSelect = document.getElementById('filialSelect');
            const option1 = document.getElementById('deliveryOption1');
            const option2 = document.getElementById('deliveryOption2');
            
            if (selfDelivery && selfDelivery.checked) {
                filialSelect.classList.add('show');
                option2.classList.add('selected');
                option1.classList.remove('selected');
                formData.delivery = 'self';
            } else {
                filialSelect.classList.remove('show');
                option1.classList.add('selected');
                option2.classList.remove('selected');
                formData.delivery = 'employer';
                formData.filial = null;
                document.getElementById('filialDropdown').value = '';
            }
            
            saveToLocalStorage();
        }
        
        function saveMutAnswer(questionId, value) {
            formData.mut[questionId] = value;
            saveToLocalStorage();
        }
        
        function openMutModal() {
            initMutQuestions();
            document.getElementById('mutModal').classList.add('show');
        }
        
        function closeMutModal() {
            document.getElementById('mutModal').classList.remove('show');
        }
        
        function saveMutAnswers() {
            const mandatoryQuestions = mutQuestions.filter(function(q) { return q.mandatory; });
            const answeredMandatory = mandatoryQuestions.filter(function(q) {
                const answer = formData.mut[q.id];
                return answer && answer !== '' && answer !== 'Se√ßin';
            });
            
            const statusDiv = document.getElementById('mutCompletionStatus');
            if (answeredMandatory.length === mandatoryQuestions.length) {
                statusDiv.innerHTML = '<div class="alert alert-success" style="margin-top: 1rem;"><span>‚úì</span> B√ºt√ºn m…ôcburi suallar cavablandƒ±rƒ±lƒ±b</div>';
            } else {
                statusDiv.innerHTML = '<div class="alert alert-warning" style="margin-top: 1rem;"><span>‚ö†</span> ' + answeredMandatory.length + '/' + mandatoryQuestions.length + ' m…ôcburi sual cavablandƒ±rƒ±lƒ±b</div>';
            }
            
            closeMutModal();
            saveToLocalStorage();
            updateFormState();
        }
        
        function updateFormState() {
            const hasPreConsent = formData.preConsent === true;
            const hasAsanAccess = formData.asanFinansAccess === true;
            const hasConsent = formData.dataConsent === true;
            
            const deliverySection = document.getElementById('deliverySection');
            const fatcaSection = document.getElementById('fatcaSection');
            const mutSection = document.getElementById('mutSection');
            const nextBtn = document.getElementById('nextPageBtn');
            
            if (!hasPreConsent) {
                deliverySection.classList.add('disabled');
                fatcaSection.classList.add('disabled');
                mutSection.classList.add('disabled');
                nextBtn.disabled = true;
            } else if (hasAsanAccess && hasConsent) {
                deliverySection.classList.remove('disabled');
                fatcaSection.classList.remove('disabled');
                mutSection.classList.remove('disabled');
                nextBtn.disabled = false;
            } else {
                deliverySection.classList.add('disabled');
                fatcaSection.classList.add('disabled');
                mutSection.classList.add('disabled');
                nextBtn.disabled = true;
            }
        }
        
        function saveToLocalStorage() {
            try {
                localStorage.setItem('bankCardFormData', JSON.stringify(formData));
            } catch(e) {
                console.error('localStorage error:', e);
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const data = localStorage.getItem('bankCardFormData');
                return data ? JSON.parse(data) : null;
            } catch(e) {
                console.error('localStorage error:', e);
                return null;
            }
        }
        
        function goToPage2() {
            if (!formData.fullName || formData.fullName.trim() === '') {
                alert('Ad soyad m…ôlumatƒ± tapƒ±lmadƒ±');
                return;
            }
            
            if (!formData.delivery) {
                alert('Z…ôhm…ôt olmasa t…ôhvil alma formasƒ±nƒ± se√ßin');
                return;
            }
            
            if (formData.delivery === 'self' && !formData.filial) {
                alert('Z…ôhm…ôt olmasa filial se√ßin');
                return;
            }
            
            const fatcaAnswered = Object.keys(formData.fatca).length === fatcaQuestions.length;
            if (!fatcaAnswered) {
                alert('Z…ôhm…ôt olmasa b√ºt√ºn √∂z√ºn√º qiym…ôtl…ôndirm…ô suallarƒ±nƒ± cavablandƒ±rƒ±n');
                return;
            }
            
            const mandatoryQuestions = mutQuestions.filter(function(q) { return q.mandatory; });
            const answeredMandatory = mandatoryQuestions.filter(function(q) {
                const answer = formData.mut[q.id];
                return answer && answer !== '' && answer !== 'Se√ßin';
            });
            
            if (answeredMandatory.length < mandatoryQuestions.length) {
                alert('Z…ôhm…ôt olmasa b√ºt√ºn m…ôcburi sorƒüu anketi suallarƒ±nƒ± cavablandƒ±rƒ±n');
                return;
            }
            
            showSummary();
            
            document.getElementById('page1').classList.remove('active');
            document.getElementById('page2').classList.add('active');
            document.getElementById('progressFill').style.width = '100%';
            window.scrollTo(0, 0);
        }
        
        function goToPage1() {
            document.getElementById('page2').classList.remove('active');
            document.getElementById('page1').classList.add('active');
            document.getElementById('progressFill').style.width = '50%';
            window.scrollTo(0, 0);
        }
        
        function showSummary() {
            const deliverySummary = document.getElementById('summaryDelivery');
            let summaryHTML = '<div class="question-item"><strong>Ad Soyad:</strong> ' + formData.fullName + '</div>';
            
            let deliveryText = formData.delivery === 'self' ? 'Kart sahibinin √∂z√º t…ôr…ôfind…ôn g√∂t√ºr√ºlm…ôsi' : 'Kartƒ±n i≈ü…ôg√∂t√ºr…ôn…ô v…ô ya onun n√ºmay…ônd…ôsin…ô t…ôhvil verilm…ôsi';
            if (formData.filial) {
                const selectedFilial = document.querySelector('#filialDropdown option[value="' + formData.filial + '"]');
                if (selectedFilial) {
                    deliveryText += ' - ' + selectedFilial.text;
                }
            }
            summaryHTML += '<div class="question-item"><strong>' + deliveryText + '</strong></div>';
            deliverySummary.innerHTML = summaryHTML;
            
            const fatcaSummary = document.getElementById('summaryFatca');
            fatcaSummary.innerHTML = fatcaQuestions.map(function(q) {
                return '<div class="question-item">' +
                    '<div class="question-text">' + q.text + '</div>' +
                    '<div><strong>' + (formData.fatca[q.id] === 'yes' ? 'B…ôli' : 'Xeyr') + '</strong></div>' +
                    '</div>';
            }).join('');
            
            const mutSummary = document.getElementById('summaryMut');
            const answeredMut = mutQuestions.filter(function(q) {
                return formData.mut[q.id] && formData.mut[q.id] !== '' && formData.mut[q.id] !== 'Se√ßin';
            }).slice(0, 5);
            
            mutSummary.innerHTML = '<div class="alert alert-success"><span>‚úì</span><span>Sorƒüu anketi tamamlandƒ±</span></div>' +
                '<div style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);">ƒ∞lk 5 cavab n√ºmun…ôsi:</div>' +
                answeredMut.map(function(q) {
                    return '<div class="question-item">' +
                        '<div class="question-text">' + q.text + '</div>' +
                        '<div><strong>' + formData.mut[q.id] + '</strong></div>' +
                        '</div>';
                }).join('');
        }
        
        function submitForm() {
            if (!confirm('Formanƒ± g√∂nd…ôrm…ôk ist…ôdiyiniz…ô …ôminsiniz?')) {
                return;
            }
            
            const submitData = {
                fullName: formData.fullName,
                companyName: formData.companyName,
                voen: formData.voen,
                asanFinansAccess: formData.asanFinansAccess,
                dataConsent: formData.dataConsent,
                delivery: formData.delivery,
                filial: formData.filial,
                fatcaAnswers: formData.fatca,
                mutAnswers: formData.mut,
                submittedAt: new Date().toISOString()
            };
            
            console.log('Submitting data:', submitData);
            
            alert('Form uƒüurla g√∂nd…ôrildi! ‚úì\n\nM…ôlumatlar backend sistem…ô √∂t√ºr√ºld√º.');
            
            localStorage.removeItem('bankCardFormData');
            
            setTimeout(function() {
                location.reload();
            }, 1000);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            fetchUserData();
            initFatcaQuestions();
            
            document.getElementById('filialDropdown').addEventListener('change', function(e) {
                formData.filial = e.target.value;
                saveToLocalStorage();
            });
            
            if (formData.preConsent) {
                document.getElementById('preConsentCheck').checked = true;
                document.getElementById('checkBtn').disabled = false;
            }
            
            if (formData.delivery) {
                const radio = document.querySelector('input[name="delivery"][value="' + formData.delivery + '"]');
                if (radio) {
                    radio.checked = true;
                    handleDeliveryChange();
                }
            }
            
            if (formData.filial) {
                document.getElementById('filialDropdown').value = formData.filial;
            }
            
            if (formData.asanFinansAccess !== null) {
                const statusDiv = document.getElementById('asanFinansStatus');
                if (formData.asanFinansAccess) {
                    statusDiv.innerHTML = '<div class="alert alert-success" style="margin-top: 1rem;"><span>‚úì</span> Giri≈ü h√ºququ m√∂vcuddur</div>';
                    document.getElementById('consentBox').style.display = 'block';
                    
                    if (formData.dataConsent) {
                        document.getElementById('dataConsentCheck').checked = true;
                    }
                } else {
                    statusDiv.innerHTML = '<div class="alert alert-error" style="margin-top: 1rem;"><span>‚úó</span> Giri≈ü h√ºququ tapƒ±lmadƒ±</div>';
                }
            }
            
            updateFormState();
            document.getElementById('progressFill').style.width = '50%';
        });
    </script>
</body>
</html>
